<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tra cứu điểm</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#004d9e" />
  </head>
  <body>
    <header>
      <h1 id="appTitle">Tra cứu điểm</h1>
      <label class="toggle">
        <input type="checkbox" id="darkToggle" />
        <span id="darkLabel">Chế độ tối</span>
      </label>
    </header>
    <main>
      <form id="searchForm" class="filters" aria-label="Search form">
        <input type="text" id="sbdInput" placeholder="SBD" aria-label="Số báo danh" />
        <input type="text" id="nameInput" placeholder="Họ và tên" aria-label="Họ và tên" />
        <select id="schoolFilter" aria-label="Trường">
          <option value="">--Trường--</option>
        </select>
        <select id="classFilter" aria-label="Lớp">
          <option value="">--Lớp--</option>
        </select>
        <select id="resultFilter" aria-label="Kết quả">
          <option value="">--Kết quả--</option>
          <option value="Đạt">Đạt</option>
          <option value="Trượt">Trượt</option>
        </select>
        <input type="number" id="minScore" min="0" step="0.1" placeholder="Điểm tối thiểu" aria-label="Điểm tối thiểu" />
        <select id="sortField" aria-label="Sắp xếp theo">
          <option value="">--Sắp xếp--</option>
          <option value="total">Tổng điểm</option>
          <option value="fullname">Tên</option>
          <option value="sbd">SBD</option>
        </select>
        <select id="sortOrder" aria-label="Thứ tự">
          <option value="asc">Tăng dần</option>
          <option value="desc">Giảm dần</option>
        </select>
        <button type="submit" id="searchBtn">Tìm</button>
        <button type="button" id="resetBtn" class="secondary">Nhập lại</button>
      </form>
      <section id="resultsSection" aria-label="Kết quả">
        <table id="resultsTable">
          <thead>
            <tr>
              <th>SBD</th>
              <th>Họ và tên</th>
              <th>Trường</th>
              <th>Lớp</th>
              <th>Toán</th>
              <th>Ngữ văn</th>
              <th>Tiếng Anh</th>
              <th>Tổng điểm</th>
              <th>Kết quả</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="pagination" id="pagination">
          <button type="button" id="prevPage">&laquo;</button>
          <span id="pageInfo">1/1</span>
          <button type="button" id="nextPage">&raquo;</button>
        </div>
        <div>
          <button type="button" id="exportCsv">Xuất CSV</button>
          <button type="button" id="exportPdf" class="secondary">Xuất PDF</button>
          <button type="button" id="shareLink" class="secondary">Sao chép liên kết</button>
        </div>
      </section>
      <section class="chart-container">
        <h2 id="chartTitle">Phân phối tổng điểm</h2>
        <div id="chart" class="bar-chart" role="figure" aria-label="Biểu đồ phân phối"></div>
      </section>
    </main>
    <footer id="footer">© 2025 by Truong Minh Khiem</footer>
    <!-- Student detail modal -->
    <div id="studentModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <button id="closeModal" class="modal-close" aria-label="Close">×</button>
        <h2 id="modalTitle">Thông tin thí sinh</h2>
        <p><strong id="labelSBD">SBD:</strong> <span id="modalSBD"></span></p>
        <p><strong id="labelName">Họ và tên:</strong> <span id="modalName"></span></p>
        <p><strong id="labelDOB">Ngày sinh:</strong> <span id="modalDOB"></span></p>
        <p><strong id="labelPOB">Nơi sinh:</strong> <span id="modalPOB"></span></p>
        <p><strong id="labelSchool">Trường:</strong> <span id="modalSchool"></span></p>
        <p><strong id="labelClass">Lớp:</strong> <span id="modalClass"></span></p>
        <p><strong id="labelMath">Toán:</strong> <span id="modalMath"></span></p>
        <p><strong id="labelLiterature">Ngữ văn:</strong> <span id="modalLiterature"></span></p>
        <p><strong id="labelEnglish">Tiếng Anh:</strong> <span id="modalEnglish"></span></p>
        <p><strong id="labelBonus">Điểm cộng:</strong> <span id="modalBonus"></span></p>
        <p><strong id="labelTotal">Tổng điểm:</strong> <span id="modalTotal"></span></p>
        <p><strong id="labelResult">Kết quả:</strong> <span id="modalResult"></span></p>
        <button id="exportStudentPdf" class="secondary">Xuất phiếu điểm</button>
      </div>
    </div>
    <div id="loadingOverlay" role="alert">Loading...</div>
    <!-- Load pre-bundled student data when running via file:// to avoid fetch restrictions -->
    <script src="data/full.js"></script>
    <script src="script.js"></script>
    <script>
      // Register service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js');
      }
    </script>
  </body>
</html>